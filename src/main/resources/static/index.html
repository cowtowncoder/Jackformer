<!doctype html>
<html lang="en">
  <head><title>Jackformer!</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/> 
<link rel='stylesheet' type='text/css' href='css/style_2021_02_08.css'>
<script type='text/javascript' src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>
  <body>
    <h1>Jackformer - the Transformative Tool</h1>
<table><tr><td>
<form id="form-input" action="rest/jackform-output-file" method="post" enctype="multipart/form-data"
     target="output-content-frame">
  <table class="inputTable">
  <tr id="input-format-row" class="active">
<td class="label"><span class="prompt">* </span><label for="input-format">Input Format: </label></td>
<td class="selector"><select id="input-format" name="inputFormat" size="1">
   <option value=""></option>
   <option value="cbor">CBOR</option>
   <option value="json">JSON</option>
   <option value="properties">Properties</option>
   <option value="smile">Smile</option>
   <option value="xml">XML</option>
   <option value="yaml">YAML</option>
</select></td>
   </tr>
  <tr id="output-format-row" class="hidden">
<td class="label"><span class="prompt">* </span><label for="output-format">Output Format: </label></td>
<td class="selector"><select id="output-format" name="outputFormat" size="1">
   <option value=""></option>
   <option value="cbor">CBOR</option>
   <option value="json">JSON</option>
   <option value="json-pretty">JSON (pretty)</option>
   <option value="properties">Properties</option>
   <option value="smile">Smile</option>
   <option value="xml">XML</option>
   <option value="xml-pretty">XML (pretty)</option>
   <option value="yaml">YAML</option>
</select></td>
   </tr>
  <tr id="input-mode-row" class="hidden">
<td class="label"><span class="prompt">* </span>Input Source: </td>
<td class="selector"><select id="input-mode" name="inputMode">
   <option value=""></option>
   <option value="input-mode-text">Text</option>
   <option value="input-mode-file">Upload</option>
</select></td>
   </tr>
  <tr id="input-as-file-row" class="hidden collapsed">
<td class="label"><span class="prompt">* </span>Input File: </td>
<td class="selector"><input type="file" id="input-as-file" name="inputFile"></input>
   </tr>
  <tr id="input-as-text-row" class="infoRow hidden collapsed">
<td class="label"><span class="prompt">* </span>Input Content: </td>
<td class="selector"><textarea id="input-as-text" name="inputText" rows="12" cols="80"></textarea>
   </tr>
  <tr id="action-row" class="hidden">
<td class="label"> </td>
<td class="selector">
<button type="button" class="button" id="button-show">Transform and Show</button>
<button type="button" class="button" id="button-download">Transform and Download</button>
    </td>
   </tr>
  </table>
</form>
</td></tr></table>

<table><tr><td>
<form id="outputForm">
 <table class="outputTable">
  <tr id="output-status-row" class="shown">
<td class="label">Status: </td>
<td><span id="output-status-message"> </span></td>
  </tr>
  <tr id="output-content-row" class="hidden collapsed">
<td class="label">Transformed Content: </td>
<td><textarea id="output-content" class="outputText" rows="12" cols="80"></textarea></td>
  </tr>
 </table>  
</form>
</td></tr></table>

<!-- iframe just as download target -->
<iframe name="output-content-frame" style="visibility:hidden;display:none;">
</iframe>

<script src="js/ui.js">
</script>

<script>

// First: listeners for input control changes
$("#input-format").on("change", function() {
  var inputFormat = $(this).val();
  if (currentInputFormat != inputFormat) {
    currentInputFormat = inputFormat;
    // Otherwise simple but need to disable text-input for binary input
    binaryInput = isBinary(inputFormat);
    if (binaryInput) {
      $("#input-mode").val("input-mode-file").prop("disabled", true);
      // will not fire event so update directly:
      currentInputMode = "input-mode-file";
    } else {
      $("#input-mode").prop("disabled", false);
    }
    updateUIState();
  }
});
$("#output-format").on("change", function() {
  var outputFormat = $(this).val();
  if (currentOutputFormat != outputFormat) {
    currentOutputFormat = outputFormat;
    // Otherwise simple but need to disable "transform & show" option
    binaryOutput = isBinary(outputFormat);
    if (binaryOutput) {
      $("#button-show").addClass("hidden");
    } else {
      $("#button-show").removeClass("hidden");
    }
    updateUIState();
  }
});
$("#input-mode").on("change", function() {
  var inputMode = $(this).val();
  if (currentInputMode != inputMode) {
    currentInputMode = inputMode;
    updateUIState();
  }
});
$("#input-as-file").on("change", function() {
  var inputFile = $(this).val();
  if (currentInputFile != inputFile) {
    currentInputFile = inputFile;
    updateUIState();
  }
});
// Textareas are tricky. 'Change' only triggers on losing focus so need
// to also do "keyup" it seems
var inputAsText = $("#input-as-text");
var inputAsTextFunc = function() {
  var inputStr = $(this).val();
  var inputText = Math.min(inputStr.length, 1);
  if (currentInputText != inputText) {
    currentInputText = inputText;
    updateUIState();
  }
};
inputAsText.on("change", inputAsTextFunc);
inputAsText.on("keyup", inputAsTextFunc);

// Second: invoking transformations: one is longer via ajax; another simplee submit
$("#button-show").click(actionTransformAndShow);
$("#button-download").click(function() {
  $("#form-input").submit();
});

// Finally, activate the input format selector directly:
$("#input-format").focus();
</script>

  </body>
</html>
